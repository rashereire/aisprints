# APITesting-Postman.mdc
# Strong Guidance – Preferred Patterns

Guidelines for API automation using Postman and Newman.

---

## Principles
- APIs SHOULD be tested independently of UI
- Schema validation SHOULD be enforced
- Tests SHOULD run via CI
ou truly want zero HTTP traffic for these pre-build checks, you’d need to change the collection so that:

•  Requests don’t point to a real backend (e.g., use a dummy URL), or
•  Move validation into separate requests that don’t depend on calling your real API, or
•  Run these validations in a pure JS test runner instead of Newman.
---

## Assertion Example
```javascript
pm.test("Status 200", () => {
  pm.response.to.have.status(200);
});
```

---

## Schema Validation
```javascript
pm.test("Schema valid", () => {
  pm.response.to.have.jsonSchema(schema);
});
```

---

## Environment Variable Usage
```javascript
pm.environment.set("userId", pm.response.json().id);
```

---

## Newman CLI
```bash
newman run collection.json -e env.json --reporters junit,htmlextra
```

---

## Jenkins Pipeline
```groovy
sh 'newman run collection.json --reporters junit'
```

---

## JIRA Integration
- JUnit XML published to Jenkins
- Xray or Zephyr Scale consumes results
- Retries SHOULD create new executions

---

## Cookie Management Best Practices
- **Use Postman's cookie jar**: Let Postman automatically store and send cookies from `Set-Cookie` responses. Avoid manually setting `Cookie` headers.
- **Setup login at collection start**: Add a setup request that logs in and captures the session cookie. The cookie jar will automatically send it to subsequent requests.
- **Use `disableCookies: true` for unauthenticated tests**: Set `"protocolProfileBehavior": { "disableCookies": true }` on requests that should test unauthenticated access.
- **Server-side logout for "no session" tests**: For tests expecting "no session" scenarios (e.g., 401 Unauthorized), call the logout endpoint server-side in a pre-request script before clearing cookies client-side. This ensures the session is invalidated on the server, not just the client.

---

## Setup Requests and Data Management
- **DO NOT use `pm.sendRequest()` in pre-request scripts for setup**: `pm.sendRequest()` is asynchronous and does not block the main request. Variables set in callbacks will not be available when the main request executes.
- **Create separate setup requests instead**: For test data that must exist before dependent tests run, create dedicated setup requests in folders (e.g., "MCQ - Attempt Setup") that execute synchronously before the tests that need them.
- **Use collection variables for test-scoped data**: Use `pm.collectionVariables.set()` and `pm.collectionVariables.get()` for test data that's scoped to a collection run (e.g., `testMcqIdForAttempt`).
- **Use environment variables for cross-collection data**: Use `pm.environment.set()` and `pm.environment.get()` for data that needs to persist across multiple collections (e.g., `authSessionCookie`).

---

## Authentication and Resource Existence Testing
- **Authenticate before testing "not found" scenarios**: If an API route checks authentication before checking resource existence, tests expecting 404 Not Found must be authenticated first. Otherwise, they will receive 401 Unauthorized before reaching the resource existence check.

---
