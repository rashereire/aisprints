{
	"info": {
		"name": "Post-Build Security Integration Tests",
		"description": "Phase 4: OWASP Security & Cross-Cutting API Tests for QuizMaker.\n\nCovers OWASP WSTG v4.2 aligned security testing across authentication, authorization, session management, input validation, and error handling.\n\nTest naming convention:\n- \"Security - [OWASP-ID] (WSTG X.X.X) - [Description]\"\nExample: \"Security - AUTHN-003 (WSTG 4.4.3) - repeated failed logins trigger lockout or rate-limit\".",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "securityTestUser1Email",
			"value": "security.test.user1@example.com"
		},
		{
			"key": "securityTestUser1Username",
			"value": "security_test_user_1"
		},
		{
			"key": "securityTestUser1Password",
			"value": "SecurityTestPassword123!"
		},
		{
			"key": "securityTestUser2Email",
			"value": "security.test.user2@example.com"
		},
		{
			"key": "securityTestUser2Username",
			"value": "security_test_user_2"
		},
		{
			"key": "securityTestUser2Password",
			"value": "SecurityTestPassword123!"
		},
		{
			"key": "securityTestMcqId",
			"value": ""
		}
	],
	"item": [
		{
			"name": "Security - Setup",
			"item": [
				{
					"name": "Security - Setup - Create test user 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verify user creation succeeded (201) or already exists (409)",
									"pm.test('Setup user 1 creation succeeded or already exists', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Security\",\n  \"lastName\": \"TestUser1\",\n  \"username\": \"{{securityTestUser1Username}}\",\n  \"email\": \"{{securityTestUser1Email}}\",\n  \"password\": \"{{securityTestUser1Password}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - Setup - Create test user 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verify user creation succeeded (201) or already exists (409)",
									"pm.test('Setup user 2 creation succeeded or already exists', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Security\",\n  \"lastName\": \"TestUser2\",\n  \"username\": \"{{securityTestUser2Username}}\",\n  \"email\": \"{{securityTestUser2Email}}\",\n  \"password\": \"{{securityTestUser2Password}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - Setup - Login as user 1 and create MCQ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verify login succeeded",
									"pm.test('Setup login as user 1 succeeded', function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"",
									"// Store session cookie for subsequent requests",
									"const sessionCookie = pm.cookies.get('session_token');",
									"pm.expect(sessionCookie).to.not.be.undefined;"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"{{securityTestUser1Username}}\",\n  \"password\": \"{{securityTestUser1Password}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - Setup - Create MCQ owned by user 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verify MCQ creation succeeded",
									"pm.test('Setup MCQ creation succeeded', function () {",
									"  pm.response.to.have.status(201);",
									"});",
									"",
									"// Store MCQ ID for authorization tests",
									"const json = pm.response.json();",
									"if (json && json.id) {",
									"  pm.collectionVariables.set('securityTestMcqId', json.id);",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"SECURITY_TEST_MCQ\",\n  \"description\": \"MCQ created for security testing\",\n  \"questionText\": \"What is 2 + 2?\",\n  \"choices\": [\n    { \"choiceText\": \"3\", \"isCorrect\": false, \"displayOrder\": 0 },\n    { \"choiceText\": \"4\", \"isCorrect\": true, \"displayOrder\": 1 },\n    { \"choiceText\": \"5\", \"isCorrect\": false, \"displayOrder\": 2 },\n    { \"choiceText\": \"6\", \"isCorrect\": false, \"displayOrder\": 3 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Authentication (WSTG 4.4)",
			"item": [
				{
					"name": "Security - AUTHN-003 (WSTG 4.4.3) - repeated failed logins trigger lockout or rate-limit",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHN-003 (WSTG 4.4.3) - repeated failed logins trigger lockout or rate-limit",
									"// OWASP AUTHN-003: Account lockout mechanism (rate limiting)",
									"//",
									"// This test attempts multiple failed logins and checks if rate limiting or account lockout is triggered.",
									"// If rate limiting is not implemented, all attempts will return 401.",
									"// If rate limiting is implemented, later attempts should return 429 (Too Many Requests) or similar.",
									"",
									"const status = pm.response.code;",
									"",
									"pm.test('Security - AUTHN-003 - failed login returns 401 or 429', function () {",
									"  // Accept 401 (not rate limited) or 429 (rate limited)",
									"  pm.expect(status).to.be.oneOf([401, 429]);",
									"});",
									"",
									"if (status === 429) {",
									"  pm.test('Security - AUTHN-003 - rate limiting is active', function () {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('error');",
									"  });",
									"} else {",
									"  // Document that rate limiting is not currently implemented",
									"  console.log('Note: Rate limiting not detected - all failed logins return 401');",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"{{securityTestUser1Username}}\",\n  \"password\": \"wrongpassword123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Authorization (WSTG 4.5)",
			"item": [
				{
					"name": "Security - Authorization Setup - Login as user 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Verify login as user 2 succeeded",
									"pm.test('Authorization setup login as user 2 succeeded', function () {",
									"  pm.response.to.have.status(200);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"{{securityTestUser2Username}}\",\n  \"password\": \"{{securityTestUser2Password}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - AUTHZ-005 - user cannot edit another user's MCQ",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get MCQ ID from collection variables",
									"const mcqId = pm.collectionVariables.get('securityTestMcqId');",
									"if (!mcqId) {",
									"  throw new Error('No security test MCQ ID found. Run Security - Setup first.');",
									"}",
									"",
									"// Set the URL with the MCQ ID",
									"pm.request.url = pm.environment.get('baseUrl') + '/api/mcqs/' + mcqId;"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-005 - user cannot edit another user's MCQ",
									"// OWASP AUTHZ-005: Users can only edit/delete their own MCQs",
									"",
									"pm.test('Security - AUTHZ-005 - unauthorized user receives 403 Forbidden', function () {",
									"  pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test('Security - AUTHZ-005 - error message indicates permission denied', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"  const errorMsg = json.error.toLowerCase();",
									"  pm.expect(errorMsg).to.include('permission') || pm.expect(errorMsg).to.include('not have permission');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Unauthorized Update Attempt\",\n  \"questionText\": \"Attempted unauthorized update?\",\n  \"choices\": [\n    { \"choiceText\": \"A\", \"isCorrect\": true, \"displayOrder\": 0 },\n    { \"choiceText\": \"B\", \"isCorrect\": false, \"displayOrder\": 1 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/{{securityTestMcqId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "{{securityTestMcqId}}"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Session Management (WSTG 4.6)",
			"item": [
				{
					"name": "Security - SESS-002 (WSTG 4.6.2) - auth cookies use HttpOnly and SameSite attributes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - SESS-002 (WSTG 4.6.2) - auth cookies use HttpOnly and SameSite attributes",
									"// OWASP SESS-002: Cookie attributes (HttpOnly, Secure, SameSite)",
									"",
									"pm.test('Security - SESS-002 - login returns 200', function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Security - SESS-002 - Set-Cookie header is present', function () {",
									"  const setCookieHeader = pm.response.headers.get('Set-Cookie');",
									"  pm.expect(setCookieHeader).to.not.be.undefined;",
									"});",
									"",
									"pm.test('Security - SESS-002 - cookie has HttpOnly attribute', function () {",
									"  const setCookieHeader = pm.response.headers.get('Set-Cookie');",
									"  pm.expect(setCookieHeader).to.include('HttpOnly');",
									"});",
									"",
									"pm.test('Security - SESS-002 - cookie has SameSite attribute', function () {",
									"  const setCookieHeader = pm.response.headers.get('Set-Cookie');",
									"  pm.expect(setCookieHeader).to.include('SameSite');",
									"});",
									"",
									"pm.test('Security - SESS-002 - cookie SameSite is Lax or Strict', function () {",
									"  const setCookieHeader = pm.response.headers.get('Set-Cookie');",
									"  pm.expect(setCookieHeader).to.match(/SameSite=(Lax|Strict)/i);",
									"});",
									"",
									"// Note: Secure attribute is only set in production (NODE_ENV === 'production')",
									"// In development, Secure may not be present, which is acceptable"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"{{securityTestUser1Username}}\",\n  \"password\": \"{{securityTestUser1Password}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Input Validation (WSTG 4.7)",
			"item": [
				{
					"name": "Security - INPVAL-005 (WSTG 4.7.5) - SQL injection payload in username is rejected",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-005 (WSTG 4.7.5) - SQL injection payload in username is rejected",
									"// OWASP INPVAL-005: SQL injection attacks blocked",
									"//",
									"// This test verifies that SQL injection payloads in username are handled safely.",
									"// The system should either:",
									"// 1. Reject the input (400 Bad Request) - preferred",
									"// 2. Accept but safely handle via parameterized queries (201 Created) - acceptable if properly parameterized",
									"",
									"const status = pm.response.code;",
									"",
									"pm.test('Security - INPVAL-005 - SQL injection attempt handled safely', function () {",
									"  // Should either reject (400) or accept and handle safely (201)",
									"  pm.expect(status).to.be.oneOf([201, 400, 409]);",
									"});",
									"",
									"if (status === 201) {",
									"  pm.test('Security - INPVAL-005 - SQL injection payload accepted but safely handled', function () {",
									"    // If accepted, verify the payload was stored as-is (not executed)",
									"    const json = pm.response.json();",
									"    if (json && json.username) {",
									"      // Username should contain the literal SQL payload, not be executed",
									"      pm.expect(json.username).to.include(\"DROP TABLE\");",
									"    }",
									"  });",
									"} else if (status === 400) {",
									"  pm.test('Security - INPVAL-005 - SQL injection payload rejected', function () {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('error');",
									"  });",
									"} else if (status === 409) {",
									"  // Username already exists (from previous test run)",
									"  pm.test('Security - INPVAL-005 - SQL injection payload username already exists', function () {",
									"    // This is acceptable - means the payload was stored in a previous run",
									"    // and the system correctly prevents duplicate usernames",
									"    pm.expect(status).to.equal(409);",
									"  });",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"SQL\",\n  \"lastName\": \"Injection\",\n  \"username\": \"'; DROP TABLE users; --\",\n  \"email\": \"sqlinjection@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Error Handling (WSTG 4.8)",
			"item": [
				{
					"name": "Security - ERR-001 (WSTG 4.8.1) - 500 error does not expose stack trace or internals",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Attempt to trigger a 500 error by sending invalid data to a route that might fail",
									"// We'll use an invalid JSON body to trigger a parsing error, or",
									"// send a request that causes a server error",
									"// Note: This test may need adjustment based on actual error scenarios"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - ERR-001 (WSTG 4.8.1) - 500 error does not expose stack trace or internals",
									"// OWASP ERR-001: Improper error handling doesn't leak information",
									"",
									"const status = pm.response.code;",
									"",
									"// Accept various error status codes (400, 500, etc.)",
									"pm.test('Security - ERR-001 - error response has appropriate status', function () {",
									"  pm.expect(status).to.be.at.least(400);",
									"});",
									"",
									"pm.test('Security - ERR-001 - error response does not contain stack trace', function () {",
									"  const responseText = pm.response.text();",
									"  pm.expect(responseText).to.not.include('at ');",
									"  pm.expect(responseText).to.not.include('Error:');",
									"  pm.expect(responseText).to.not.include('Stack:');",
									"  pm.expect(responseText).to.not.include('stack trace');",
									"});",
									"",
									"pm.test('Security - ERR-001 - error response does not expose file paths', function () {",
									"  const responseText = pm.response.text();",
									"  pm.expect(responseText).to.not.match(/\\/[a-z0-9_\\-\\/]+\\.(ts|js|tsx|jsx)/i);",
									"});",
									"",
									"pm.test('Security - ERR-001 - error response does not expose internal details', function () {",
									"  const responseText = pm.response.text();",
									"  pm.expect(responseText).to.not.include('database');",
									"  pm.expect(responseText).to.not.include('sql');",
									"  pm.expect(responseText).to.not.include('query');",
									"  pm.expect(responseText).to.not.include('connection');",
									"});",
									"",
									"pm.test('Security - ERR-001 - error response has generic error message', function () {",
									"  try {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('error');",
									"    // Error message should be user-friendly, not technical",
									"    const errorMsg = json.error.toLowerCase();",
									"    pm.expect(errorMsg).to.not.include('stack');",
									"    pm.expect(errorMsg).to.not.include('trace');",
									"    pm.expect(errorMsg).to.not.include('exception');",
									"  } catch (e) {",
									"    // If response is not JSON, that's also acceptable",
									"    pm.expect(pm.response.code).to.be.at.least(400);",
									"  }",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"invalid\": \"data that will cause an error\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/generate-teks",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "generate-teks"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Identity Management (WSTG 4.3)",
			"item": [
				{
					"name": "Security - IDM-001 (WSTG 4.3.1) - user registration process validation",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - IDM-001 (WSTG 4.3.1) - user registration process validation",
									"// OWASP IDM-001: User registration process is secure and validated",
									"",
									"const status = pm.response.code;",
									"",
									"pm.test('Security - IDM-001 - registration returns 201 or 400', function () {",
									"  pm.expect(status).to.be.oneOf([201, 400]);",
									"});",
									"",
									"if (status === 201) {",
									"  pm.test('Security - IDM-001 - registration response includes user data', function () {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('user');",
									"    pm.expect(json.user).to.have.property('id');",
									"    pm.expect(json.user).to.have.property('username');",
									"    pm.expect(json.user).to.not.have.property('password');",
									"    pm.expect(json.user).to.not.have.property('passwordHash');",
									"  });",
									"} else if (status === 400) {",
									"  pm.test('Security - IDM-001 - validation errors are returned', function () {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('error');",
									"  });",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"IDM\",\n  \"lastName\": \"Test\",\n  \"username\": \"idm_test_user_\" + Date.now(),\n  \"email\": \"idm_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - IDM-002 (WSTG 4.3.2) - duplicate username/email detection",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - IDM-002 (WSTG 4.3.2) - duplicate username/email detection",
									"// OWASP IDM-002: System prevents duplicate usernames and emails",
									"",
									"pm.test('Security - IDM-002 - duplicate registration returns 409', function () {",
									"  pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test('Security - IDM-002 - error message indicates conflict', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"  const errorMsg = json.error.toLowerCase();",
									"  pm.expect(errorMsg).to.include('already exists') || pm.expect(errorMsg).to.include('duplicate');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"IDM\",\n  \"lastName\": \"Test\",\n  \"username\": \"{{securityTestUser1Username}}\",\n  \"email\": \"{{securityTestUser1Email}}\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - IDM-003 (WSTG 4.3.3) - account enumeration prevention",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - IDM-003 (WSTG 4.3.3) - account enumeration prevention",
									"// OWASP IDM-003: Login errors don't reveal if username/email exists",
									"",
									"pm.test('Security - IDM-003 - login with non-existent user returns 401', function () {",
									"  pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test('Security - IDM-003 - error message is generic (does not reveal account existence)', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"  const errorMsg = json.error.toLowerCase();",
									"  // Should not reveal whether username exists or not",
									"  pm.expect(errorMsg).to.not.include('username');",
									"  pm.expect(errorMsg).to.not.include('email');",
									"  pm.expect(errorMsg).to.not.include('not found');",
									"  pm.expect(errorMsg).to.not.include('does not exist');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"nonexistent_user_\" + Date.now(),\n  \"password\": \"WrongPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - IDM-004 (WSTG 4.3.4) - username enumeration prevention",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - IDM-004 (WSTG 4.3.4) - username enumeration prevention",
									"// OWASP IDM-004: Registration errors don't reveal existing usernames",
									"",
									"pm.test('Security - IDM-004 - duplicate username registration returns 409', function () {",
									"  pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test('Security - IDM-004 - error message does not reveal which field is duplicate', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"  // Error should be generic enough to not reveal enumeration",
									"  // Acceptable: 'Username already exists' or 'Email already exists' (specific)",
									"  // Also acceptable: 'User already exists' (generic)",
									"  pm.expect(json.error).to.be.a('string');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"IDM\",\n  \"lastName\": \"Test\",\n  \"username\": \"{{securityTestUser1Username}}\",\n  \"email\": \"idm_unique_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - IDM-005 (WSTG 4.3.5) - username policy enforcement",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - IDM-005 (WSTG 4.3.5) - username policy enforcement",
									"// OWASP IDM-005: Username validation rules are enforced",
									"",
									"pm.test('Security - IDM-005 - invalid username format returns 400', function () {",
									"  pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Security - IDM-005 - validation error includes username details', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"IDM\",\n  \"lastName\": \"Test\",\n  \"username\": \"invalid-username-with-special-chars!\",\n  \"email\": \"idm_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Authentication Additional (WSTG 4.4)",
			"item": [
				{
					"name": "Security - AUTHN-002 (WSTG 4.4.2) - no default credentials exist",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHN-002 (WSTG 4.4.2) - no default credentials exist",
									"// OWASP AUTHN-002: Common default credentials are rejected",
									"",
									"pm.test('Security - AUTHN-002 - default admin credentials return 401', function () {",
									"  pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test('Security - AUTHN-002 - default credentials do not authenticate', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"admin\",\n  \"password\": \"admin\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - AUTHN-004 (WSTG 4.4.4) - authentication schema cannot be bypassed",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHN-004 (WSTG 4.4.4) - authentication schema cannot be bypassed",
									"// OWASP AUTHN-004: Authentication cannot be bypassed via parameter manipulation",
									"",
									"pm.test('Security - AUTHN-004 - missing password returns 400', function () {",
									"  pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Security - AUTHN-004 - authentication bypass attempt fails', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"usernameOrEmail\": \"{{securityTestUser1Username}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - AUTHN-007 (WSTG 4.4.7) - password complexity requirements enforced",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHN-007 (WSTG 4.4.7) - password complexity requirements enforced",
									"// OWASP AUTHN-007: Password policy is enforced",
									"",
									"pm.test('Security - AUTHN-007 - weak password returns 400', function () {",
									"  pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Security - AUTHN-007 - validation error includes password requirements', function () {",
									"  const json = pm.response.json();",
									"  pm.expect(json).to.have.property('error');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"AUTHN\",\n  \"lastName\": \"Test\",\n  \"username\": \"authn_test_\" + Date.now(),\n  \"email\": \"authn_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"weak\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Authorization Additional (WSTG 4.5)",
			"item": [
				{
					"name": "Security - AUTHZ-001 (WSTG 4.5.1) - directory traversal attacks prevented",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-001 (WSTG 4.5.1) - directory traversal attacks prevented",
									"// OWASP AUTHZ-001: Path traversal attacks are blocked",
									"",
									"pm.test('Security - AUTHZ-001 - directory traversal attempt returns 400 or 404', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([400, 404]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/../../../etc/passwd",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "../../../etc/passwd"]
						}
					}
				},
				{
					"name": "Security - AUTHZ-002 (WSTG 4.5.2) - authorization schema cannot be bypassed",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-002 (WSTG 4.5.2) - authorization schema cannot be bypassed",
									"// OWASP AUTHZ-002: Authorization checks cannot be bypassed",
									"",
									"pm.test('Security - AUTHZ-002 - unauthenticated request to protected endpoint returns 401', function () {",
									"  pm.response.to.have.status(401);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/me",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "me"]
						}
					}
				},
				{
					"name": "Security - AUTHZ-004 (WSTG 4.5.4) - insecure direct object references prevented",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get MCQ ID from collection variables",
									"const mcqId = pm.collectionVariables.get('securityTestMcqId');",
									"if (!mcqId) {",
									"  throw new Error('No security test MCQ ID found. Run Security - Setup first.');",
									"}",
									"",
									"// Set the URL with the MCQ ID",
									"pm.request.url = pm.environment.get('baseUrl') + '/api/mcqs/' + mcqId;",
									"",
									"// Clear any existing session cookies (unauthenticated access)",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-004 (WSTG 4.5.4) - insecure direct object references prevented",
									"// OWASP AUTHZ-004: Direct object references require authentication",
									"",
								"pm.test('Security - AUTHZ-004 - direct object reference handled appropriately', function () {",
								"  // GET /api/mcqs/[id] may be public or require auth - both are acceptable",
								"  // If public: returns 200 or 404",
								"  // If protected: returns 401",
								"  pm.expect(pm.response.code).to.be.oneOf([200, 401, 404]);",
								"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/{{securityTestMcqId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "{{securityTestMcqId}}"]
						}
					}
				},
				{
					"name": "Security - AUTHZ-006 (WSTG 4.5.6) - protected routes require authentication",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-006 (WSTG 4.5.6) - protected routes require authentication",
									"// OWASP AUTHZ-006: Protected endpoints enforce authentication",
									"",
								"pm.test('Security - AUTHZ-006 - protected route returns 401 or 400 without auth', function () {",
								"  // Validation may happen before authentication",
								"  pm.expect(pm.response.code).to.be.oneOf([401, 400]);",
								"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Test\",\n  \"questionText\": \"Test?\",\n  \"choices\": [\n    { \"choiceText\": \"A\", \"isCorrect\": true, \"displayOrder\": 0 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - AUTHZ-007 (WSTG 4.5.7) - API endpoints enforce ownership checks",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get MCQ ID from collection variables",
									"const mcqId = pm.collectionVariables.get('securityTestMcqId');",
									"if (!mcqId) {",
									"  throw new Error('No security test MCQ ID found. Run Security - Setup first.');",
									"}",
									"",
									"// Set the URL with the MCQ ID",
									"pm.request.url = pm.environment.get('baseUrl') + '/api/mcqs/' + mcqId;"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - AUTHZ-007 (WSTG 4.5.7) - API endpoints enforce ownership checks",
									"// OWASP AUTHZ-007: Ownership verification is enforced",
									"// Note: User 2 is logged in from Authorization Setup, so should get 403",
									"// If MCQ was already deleted, may get 404",
									"",
									"pm.test('Security - AUTHZ-007 - unauthorized user receives 403 or 404', function () {",
									"  // 403 = unauthorized (expected), 404 = MCQ not found (acceptable if already deleted)",
									"  pm.expect(pm.response.code).to.be.oneOf([403, 404]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/{{securityTestMcqId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "{{securityTestMcqId}}"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Session Management Additional (WSTG 4.6)",
			"item": [
				{
					"name": "Security - SESS-006 (WSTG 4.6.6) - logout functionality invalidates session",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - SESS-006 (WSTG 4.6.6) - logout functionality invalidates session",
									"// OWASP SESS-006: Logout invalidates session completely",
									"",
									"pm.test('Security - SESS-006 - logout returns 200', function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"",
								"pm.test('Security - SESS-006 - session cookie is cleared', function () {",
								"  const setCookieHeader = pm.response.headers.get('Set-Cookie');",
								"  if (setCookieHeader) {",
								"    // Cookie should be cleared (expires in past, max-age=0, or empty value)",
								"    const isCleared = setCookieHeader.includes('Max-Age=0') || setCookieHeader.includes('Expires=') || setCookieHeader.includes('session_token=;');",
								"    pm.expect(isCleared).to.be.true;",
								"  }",
								"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/auth/logout",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "logout"]
						}
					}
				},
				{
					"name": "Security - SESS-006 Follow-up - verify session invalidated after logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - SESS-006 Follow-up - verify session invalidated after logout",
									"",
									"pm.test('Security - SESS-006 - invalidated session returns 401', function () {",
									"  pm.response.to.have.status(401);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/auth/me",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "me"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Input Validation Additional (WSTG 4.7)",
			"item": [
				{
					"name": "Security - INPVAL-001 (WSTG 4.7.1) - reflected XSS attacks prevented",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-001 (WSTG 4.7.1) - reflected XSS attacks prevented",
									"// OWASP INPVAL-001: Reflected XSS payloads are sanitized",
									"",
									"pm.test('Security - INPVAL-001 - XSS payload handled safely', function () {",
									"  pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Security - INPVAL-001 - XSS payload not reflected in response', function () {",
									"  const responseBody = pm.response.text();",
									"  pm.expect(responseBody).to.not.include('<script>');",
									"  pm.expect(responseBody).to.not.include('alert(\"XSS\")');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"<script>alert(\\\"XSS\\\")</script>\",\n  \"lastName\": \"Test\",\n  \"username\": \"xss_test_\" + Date.now(),\n  \"email\": \"xss_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - INPVAL-002 (WSTG 4.7.2) - stored XSS attacks prevented",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-002 (WSTG 4.7.2) - stored XSS attacks prevented",
									"// OWASP INPVAL-002: Stored XSS payloads are sanitized",
									"",
									"pm.test('Security - INPVAL-002 - XSS payload in MCQ title handled safely', function () {",
									"  // Should either reject (400) or accept and sanitize (201)",
									"  // Note: 401 is acceptable if authentication is required first",
									"  pm.expect(pm.response.code).to.be.oneOf([201, 400, 401]);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"  pm.test('Security - INPVAL-002 - XSS payload not stored as-is', function () {",
									"    const json = pm.response.json();",
									"    if (json && json.title) {",
									"      // Title should be sanitized (no script tags)",
									"      pm.expect(json.title).to.not.include('<script>');",
									"    }",
									"  });",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"<script>alert(\\\"XSS\\\")</script>Stored XSS Test\",\n  \"questionText\": \"Test question?\",\n  \"choices\": [\n    { \"choiceText\": \"A\", \"isCorrect\": true, \"displayOrder\": 0 },\n    { \"choiceText\": \"B\", \"isCorrect\": false, \"displayOrder\": 1 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - INPVAL-003 (WSTG 4.7.3) - HTTP verb tampering prevented",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-003 (WSTG 4.7.3) - HTTP verb tampering prevented",
									"// OWASP INPVAL-003: Unsupported HTTP methods are rejected",
									"// Note: Protected endpoints may return 401 before 405",
									"",
									"pm.test('Security - INPVAL-003 - unsupported HTTP method returns 405 or 401', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([405, 401]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - INPVAL-009 (WSTG 4.7.9) - input length limits enforced",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-009 (WSTG 4.7.9) - input length limits enforced",
									"// OWASP INPVAL-009: Input length validation prevents buffer overflow",
									"",
									"pm.test('Security - INPVAL-009 - excessively long input returns 400', function () {",
									"  pm.response.to.have.status(400);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"A\".repeat(1000),\n  \"lastName\": \"Test\",\n  \"username\": \"length_test_\" + Date.now(),\n  \"email\": \"length_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Security - INPVAL-010 (WSTG 4.7.10) - special characters sanitized",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - INPVAL-010 (WSTG 4.7.10) - special characters sanitized",
									"// OWASP INPVAL-010: Special characters are handled safely",
									"",
									"const status = pm.response.code;",
									"",
									"pm.test('Security - INPVAL-010 - special characters handled safely', function () {",
									"  // Should either reject (400) or accept and sanitize (201)",
									"  pm.expect(status).to.be.oneOf([201, 400]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Special!@#$%^&*()\",\n  \"lastName\": \"Test\",\n  \"username\": \"special_test_\" + Date.now(),\n  \"email\": \"special_test_\" + Date.now() + \"@example.com\",\n  \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "register"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Error Handling Additional (WSTG 4.8)",
			"item": [
				{
					"name": "Security - ERR-003 (WSTG 4.8.3) - error messages don't expose sensitive information",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - ERR-003 (WSTG 4.8.3) - error messages don't expose sensitive information",
									"// OWASP ERR-003: Error messages are generic and don't leak sensitive data",
									"",
								"pm.test('Security - ERR-003 - error response does not expose sensitive data', function () {",
								"  const responseText = pm.response.text();",
								"  // Note: 'password' in validation error messages is acceptable (field name, not actual password)",
								"  // We check that actual password values are not exposed",
								"  pm.expect(responseText).to.not.include('passwordHash');",
								"  pm.expect(responseText).to.not.include('hash');",
								"  pm.expect(responseText).to.not.include('token');",
								"  pm.expect(responseText).to.not.include('secret');",
								"  // Check that no actual password values are present (8+ character strings)",
								"  const passwordPattern = /\"password\"\\s*:\\s*\"[^\"]{8,}\"/i;",
								"  pm.expect(responseText).to.not.match(passwordPattern);",
								"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"invalid\": \"data\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Security - ERR-004 (WSTG 4.8.4) - appropriate HTTP status codes returned",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - ERR-004 (WSTG 4.8.4) - appropriate HTTP status codes returned",
									"// OWASP ERR-004: HTTP status codes match error conditions",
									"// Note: Protected endpoints return 401 before validation errors",
									"",
									"pm.test('Security - ERR-004 - invalid request returns 400 or 401', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"invalid\": \"json\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - ERR-005 (WSTG 4.8.5) - generic error messages for users",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - ERR-005 (WSTG 4.8.5) - generic error messages for users",
									"// OWASP ERR-005: Error messages are user-friendly and generic",
									"",
									"pm.test('Security - ERR-005 - error response has generic message', function () {",
									"  try {",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.property('error');",
									"    const errorMsg = json.error.toLowerCase();",
									"    // Should not contain technical details",
									"    pm.expect(errorMsg).to.not.include('stack');",
									"    pm.expect(errorMsg).to.not.include('exception');",
									"    pm.expect(errorMsg).to.not.include('undefined');",
									"  } catch (e) {",
									"    // If not JSON, that's acceptable",
									"    pm.expect(pm.response.code).to.be.at.least(400);",
									"  }",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/nonexistent-id-12345",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "nonexistent-id-12345"]
						}
					}
				}
			]
		},
		{
			"name": "Security - Business Logic (WSTG 4.10)",
			"item": [
				{
					"name": "Security - BUSLOGIC-001 (WSTG 4.10.1) - business logic data validation enforced",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - BUSLOGIC-001 (WSTG 4.10.1) - business logic data validation enforced",
									"// OWASP BUSLOGIC-001: Business rules are enforced",
									"// Note: Protected endpoints return 401 before validation errors",
									"",
									"pm.test('Security - BUSLOGIC-001 - MCQ with no choices returns 400 or 401', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Invalid MCQ\",\n  \"questionText\": \"Test?\",\n  \"choices\": []\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - BUSLOGIC-007 (WSTG 4.10.7) - MCQ creation requires authentication",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - BUSLOGIC-007 (WSTG 4.10.7) - MCQ creation requires authentication",
									"// OWASP BUSLOGIC-007: Protected operations require authentication",
									"",
									"pm.test('Security - BUSLOGIC-007 - unauthenticated MCQ creation returns 401', function () {",
									"  pm.response.to.have.status(401);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Test\",\n  \"questionText\": \"Test?\",\n  \"choices\": [\n    { \"choiceText\": \"A\", \"isCorrect\": true, \"displayOrder\": 0 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - BUSLOGIC-008 (WSTG 4.10.8) - MCQ update requires ownership verification",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get MCQ ID from collection variables",
									"const mcqId = pm.collectionVariables.get('securityTestMcqId');",
									"if (!mcqId) {",
									"  throw new Error('No security test MCQ ID found. Run Security - Setup first.');",
									"}",
									"",
									"// Set the URL with the MCQ ID",
									"pm.request.url = pm.environment.get('baseUrl') + '/api/mcqs/' + mcqId;"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - BUSLOGIC-008 (WSTG 4.10.8) - MCQ update requires ownership verification",
									"// OWASP BUSLOGIC-008: Update operations verify ownership",
									"// Note: User 2 is logged in from Authorization Setup, so should get 403",
									"",
									"pm.test('Security - BUSLOGIC-008 - unauthorized update returns 403 or 401', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([403, 401]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Unauthorized Update\",\n  \"questionText\": \"Test?\",\n  \"choices\": [\n    { \"choiceText\": \"A\", \"isCorrect\": true, \"displayOrder\": 0 }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/{{securityTestMcqId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "{{securityTestMcqId}}"]
						}
					}
				}
			]
		},
		{
			"name": "Security - API Testing (WSTG 4.12)",
			"item": [
				{
					"name": "Security - API-001 (WSTG 4.12.1) - API authentication required for protected endpoints",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - API-001 (WSTG 4.12.1) - API authentication required for protected endpoints",
									"// OWASP API-001: Protected API endpoints require authentication",
									"",
									"pm.test('Security - API-001 - protected API endpoint returns 401', function () {",
									"  pm.response.to.have.status(401);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"protocolProfileBehavior": {
							"disableCookies": true
						},
						"url": {
							"raw": "{{baseUrl}}/api/auth/me",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "me"]
						}
					}
				},
				{
					"name": "Security - API-002 (WSTG 4.12.2) - API authorization checks enforced",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Get MCQ ID from collection variables",
									"const mcqId = pm.collectionVariables.get('securityTestMcqId');",
									"if (!mcqId) {",
									"  throw new Error('No security test MCQ ID found. Run Security - Setup first.');",
									"}",
									"",
									"// Set the URL with the MCQ ID",
									"pm.request.url = pm.environment.get('baseUrl') + '/api/mcqs/' + mcqId;"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - API-002 (WSTG 4.12.2) - API authorization checks enforced",
									"// OWASP API-002: API endpoints enforce authorization",
									"// Note: User 2 is logged in from Authorization Setup, so should get 403",
									"",
									"pm.test('Security - API-002 - unauthorized API request returns 403 or 401', function () {",
									"  pm.expect(pm.response.code).to.be.oneOf([403, 401]);",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/mcqs/{{securityTestMcqId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs", "{{securityTestMcqId}}"]
						}
					}
				},
				{
					"name": "Security - API-003 (WSTG 4.12.3) - API input validation (Zod schemas)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Clear any existing session cookies",
									"pm.request.headers.remove('Cookie');"
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - API-003 (WSTG 4.12.3) - API input validation (Zod schemas)",
									"// OWASP API-003: API input validation is enforced",
									"// Note: Protected endpoints return 401 before validation errors",
									"",
								"pm.test('Security - API-003 - invalid input returns 400 or 401', function () {",
								"  pm.expect(pm.response.code).to.be.oneOf([400, 401]);",
								"});",
								"",
								"pm.test('Security - API-003 - validation error includes details', function () {",
								"  const json = pm.response.json();",
								"  pm.expect(json).to.have.property('error');",
								"});"
							]
						}
					}
				],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Test\",\n  \"questionText\": \"Test?\",\n  \"choices\": \"invalid\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				},
				{
					"name": "Security - API-005 (WSTG 4.12.5) - API error responses don't leak information",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Security - API-005 (WSTG 4.12.5) - API error responses don't leak information",
									"// OWASP API-005: API error responses are secure",
									"",
									"pm.test('Security - API-005 - API error does not expose stack trace', function () {",
									"  const responseText = pm.response.text();",
									"  pm.expect(responseText).to.not.include('at ');",
									"  pm.expect(responseText).to.not.include('Error:');",
									"});",
									"",
									"pm.test('Security - API-005 - API error does not expose internal details', function () {",
									"  const responseText = pm.response.text();",
									"  pm.expect(responseText).to.not.include('database');",
									"  pm.expect(responseText).to.not.include('sql');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"invalid\": \"data\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/mcqs",
							"host": ["{{baseUrl}}"],
							"path": ["api", "mcqs"]
						}
					}
				}
			]
		}
	]
}
